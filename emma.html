<!DOCTYPE html>
<html lang="en">
<!-- Previous head and style sections remain the same -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emma AI Assistant</title>
    <style>
        /* Previous styles remain the same */
        .image-preload {
            position: absolute;
            width: 1px;
            height: 1px;
            opacity: 0;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <!-- Add preload div for images -->
    <div id="imagePreload" class="image-preload">
        <img src="./emma.png" alt="Emma Default" onload="imageLoaded('emma.png')" onerror="imageError('emma.png')">
        <img src="./emma2.png" alt="Emma Speaking" onload="imageLoaded('emma2.png')" onerror="imageError('emma2.png')">
    </div>

    <div id="debugPanel"></div>
    <div class="background-container">
        <img id="backgroundImage" class="background-image" src="./emma.png" alt="Emma Background">
    </div>
    
    <elevenlabs-convai agent-id="UFCiWykxf7I8pgANcBuJ"></elevenlabs-convai>
    
    <script src="https://elevenlabs.io/convai-widget/index.js"></script>
    <script>
        // Track available images
        const availableImages = {
            'emma.png': false,
            'emma2.png': false
        };

        function imageLoaded(imageName) {
            availableImages[imageName] = true;
            logDebug(`Image loaded successfully:`, imageName);
        }

        function imageError(imageName) {
            availableImages[imageName] = false;
            logDebug(`⚠️ Error loading image:`, imageName);
        }

        function switchBackground(speaking) {
            if (speaking === currentSpeakingState) {
                logDebug('Speaking state unchanged:', speaking);
                return;
            }

            const newSrc = speaking ? './emma2.png' : './emma.png';
            
            // Check if the target image is available
            if (!availableImages[speaking ? 'emma2.png' : 'emma.png']) {
                logDebug(`⚠️ Cannot switch background - image not available:`, newSrc);
                return;
            }

            currentSpeakingState = speaking;
            const bgImage = document.getElementById('backgroundImage');
            
            logDebug(`Speaking state changed to:`, speaking, true);
            logDebug(`Switching background to:`, newSrc);
            
            bgImage.src = newSrc;
        }

        // Rest of the code remains the same
        // ... (previous logging, initialization, and event handling code)
    </script>
</body>
</html>
