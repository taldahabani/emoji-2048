<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emma AI Assistant</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            height: 100%;
            width: 100%;
            overflow: hidden;
            position: fixed;
        }
        .background-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-color: #000;
        }
        .background-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            object-position: center;
            max-width: 100vw;
            max-height: 100vh;
        }
        @media screen and (max-width: 768px) {
            .background-image {
                object-position: center center;
            }
        }
    </style>
</head>
<body>
    <div class="background-container">
        <img class="background-image" src="./emma.png" alt="Emma Background">
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const agentId = 'UFCiWykxf7I8pgANcBuJ';
            const socket = new WebSocket(`wss://api.elevenlabs.io/v1/convai/conversation?agent_id=${agentId}`);

            socket.onopen = function() {
                console.log('WebSocket connection established');
            };

            socket.onmessage = function(event) {
                const data = JSON.parse(event.data);
                if (data.type === 'agent_response') {
                    const agentText = data.agent_response_event.agent_response;
                    console.log('Agent says:', agentText);
                    // Display or process the agent's response as needed
                }
            };

            socket.onclose = function() {
                console.log('WebSocket connection closed');
            };

            socket.onerror = function(error) {
                console.error('WebSocket error:', error);
            };

            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(stream => {
                    const mediaRecorder = new MediaRecorder(stream);
                    mediaRecorder.ondataavailable = function(event) {
                        if (event.data.size > 0) {
                            const reader = new FileReader();
                            reader.onload = function() {
                                const base64Audio = reader.result.split(',')[1];
                                socket.send(JSON.stringify({ user_audio_chunk: base64Audio }));
                            };
                            reader.readAsDataURL(event.data);
                        }
                    };
                    mediaRecorder.start(250); // Send audio chunks every 250ms
                })
                .catch(error => {
                    console.error('Error accessing microphone:', error);
                });
        });
    </script>
</body>
</html>
